<!DOCTYPE html>
<html>

<head>
    <title>UV</title>
    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    
    <!-- core three.js -->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
    
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/OBJLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/EXRLoader.js"></script>
    <!-- โหลด GLTFLoader-->
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/loaders/GLTFLoader.js"></script> 

    <!-- lil-gui -->
    <script src="https://cdn.jsdelivr.net/npm/lil-gui@0.17"></script>
    <script>
       

        const renderer = new THREE.WebGLRenderer();
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.shadowMap.enabled = true; // ✅ เปิดใช้งานเงา!
        renderer.shadowMap.type = THREE.PCFSoftShadowMap;
        document.body.appendChild(renderer.domElement);

        const scene = new THREE.Scene();

        // ✅ กล้อง
        const camera = new THREE.PerspectiveCamera(
            75,
            window.innerWidth / window.innerHeight,
            0.1,
            1000
        );
        camera.position.set(0, 2, 4);
        camera.lookAt(0, 0, 0);
        const controls = new THREE.OrbitControls(camera, renderer.domElement);

        //Ambient Light
        const ambientLight = new THREE.AmbientLight(0x808080); // แสงสว่างทั่วไป
        scene.add(ambientLight);
        //Directional Light
        const directionalLight = new THREE.DirectionalLight(0xffeedd, 0.8); // แสงทิศทาง
        directionalLight.position.set(10, 5, 10);
        directionalLight.castShadow = true; // ✅ แสงนี้สร้างเงา
        scene.add(directionalLight);
        //แสดงตำแหน่งแสง
        const lightHelper = new THREE.DirectionalLightHelper(directionalLight, 1);
        scene.add(lightHelper);

        // ✅ Load environment EXR
        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        pmremGenerator.compileEquirectangularShader();

        const exrLoader = new THREE.EXRLoader();
        exrLoader.load(
            'https://github.com/chotika47/ComGraph_Final/blob/98539e10a59bbcb5874f17ac36ec080c854c73b0/symmetrical_garden_02_1k.exr',
            (texture) => {
                const envMap = pmremGenerator.fromEquirectangular(texture).texture;
                scene.environment = envMap;
                scene.background = envMap;

                texture.dispose();
                pmremGenerator.dispose();
            },
            undefined,
            (err) => {
                console.error('EXR load error:', err);
            }
        );

        //พื้น
        const textFloor = new THREE.TextureLoader().load('https://chotika47.github.io/ComGraph_Final/brick_pavement_02_diff_1k.jpg', t => {
            t.wrapS = THREE.RepeatWrapping;
            t.wrapT = THREE.RepeatWrapping;
        });
        //map
        const matFloor = new THREE.MeshStandardMaterial({
            map: textFloor
        });
        const planeGeometry = new THREE.PlaneGeometry(10, 10);
        //const planeMaterial = new THREE.MeshStandardMaterial({ color: 0xffffff });
        const plane = new THREE.Mesh(planeGeometry, matFloor);
        plane.rotation.x = -Math.PI / 2; // หมุนให้เป็นพื้น
        //plane.position.y = -0.5;
        plane.receiveShadow = true; // ✅ พื้นรับเงา
        scene.add(plane);

        
        /*
        function loadObj (pathOBJ){
            const objLoader = new OBJLoader();
            objLoader.load(pathOBJ, (root) => {
                scene.add(root);
            });
        }
        
        function loadMtl (pathMTL){
            const mtlLoader = new MTLLoader();
            mtlLoader.load('resources/models/windmill/windmill.mtl', (mtl) => {
                mtl.preload();
                objLoader.setMaterials(mtl);
            });
        }
        */
        

        //ฟังก์ชันโหลด obj + ใส่texture 
        function loadOBJwithMaps(pathOBJ, textures, position = { x: 0, y: 0, z: 0 }, scale = 1) {
            const loader = new THREE.OBJLoader();
            const texLoader = new THREE.TextureLoader();

            const material = new THREE.MeshStandardMaterial({
                map: textures.baseColor ? texLoader.load(textures.baseColor) : null,
                normalMap: textures.normal ? texLoader.load(textures.normal) : null,
                roughnessMap: textures.roughness ? texLoader.load(textures.roughness) : null,
                roughness: 1.0,
                metalnessMap: textures.metalness ? texLoader.load(textures.metalness) : null,
                metalness: 0.0
            });

            //โหลด obj จาก link
            loader.load(
                pathOBJ,
                (object) => {
                    object.traverse((child) => {
                        if (child.isMesh) {
                            child.material = material;
                            child.castShadow = true;
                            child.receiveShadow = true;
                        }
                    });

                    object.position.set(position.x, position.y, position.z);
                    object.scale.set(scale, scale, scale);
                    scene.add(object);
                }
            );
        }

        //ฟังก์ชันโหลด glb + ใส่ texture 
        /*
        function loadOBJwithMaps(pathOBJ, textures, position = { x: 0, y: 0, z: 0 }, scale = 1) {
            const loader = new THREE.OBJLoader();
            const texLoader = new THREE.TextureLoader();

            const material = new THREE.MeshStandardMaterial({
                map: textures.baseColor ? texLoader.load(textures.baseColor) : null,
                normalMap: textures.normal ? texLoader.load(textures.normal) : null,
                roughnessMap: textures.roughness ? texLoader.load(textures.roughness) : null,
                roughness: 1.0,
                metalnessMap: textures.metalness ? texLoader.load(textures.metalness) : null,
                metalness: 0.0
            });
            

            //โหลด obj จาก link
            loader.load(
                pathOBJ,
                (object) => {
                    object.traverse((child) => {
                        if (child.isMesh) {
                            child.material = material;
                            child.castShadow = true;
                            child.receiveShadow = true;
                        }
                    });

                    object.position.set(position.x, position.y, position.z);
                    object.scale.set(scale, scale, scale);
                    scene.add(object);
                }
            );
        }
        */

        // โหลดร้าน
        //fl-1
        /*
        loadOBJwithMaps(
            'https://chotika47.github.io/ComGraph_Final/fl1.obj',
            { baseColor: 'https://chotika47.github.io/ComGraph_Final/wood_baseColor.png',
              normal: 'https://chotika47.github.io/ComGraph_Final/wood_normal.png',
              metalness: 'https://chotika47.github.io/ComGraph_Final/wood_metallicRoughness.png'
            },
            { x: 0, y: 0, z: 0 },
            1
        );
        
        //fl-2
        loadOBJwithMaps(
            'https://chotika47.github.io/ComGraph_Final/fl2.obj',
            { baseColor: 'https://chotika47.github.io/ComGraph_Final/wood_baseColor.png',
              normal: 'https://chotika47.github.io/ComGraph_Final/wood_normal.png',
              metalness: 'https://chotika47.github.io/ComGraph_Final/wood_metallicRoughness.png',
            },
            { x: 0, y: 0, z: 0 },
            1
        );
        */
        
        // โหลดต้นไม้
        loadOBJwithMaps(
            'https://chotika47.github.io/ComGraph_Final/trank.obj',
            { baseColor: 'https://chotika47.github.io/ComGraph_Final/Trank_baseColor.png',
              normal: 'https://chotika47.github.io/ComGraph_Final/Trank_normal.png',
            },
            { x: 0, y: 0, z: 0 },
            1
        );
        loadOBJwithMaps(
            'https://chotika47.github.io/ComGraph_Final/leaves.obj',
            { baseColor: 'https://chotika47.github.io/ComGraph_Final/Leavs_baseColor.png'},
            { x: 0, y: 0, z: 0 },
            1
        );

        // โหลดบันได
        loadOBJwithMaps(
            'https://chotika47.github.io/ComGraph_Final/stair.obj',
            { baseColor: 'https://chotika47.github.io/ComGraph_Final/Material.002_baseColor.jpeg',
              //normal: 'https://chotika47.github.io/ComGraph_Final/Material_008_normal.png',
              metalness: 'https://chotika47.github.io/ComGraph_Final/Material.002_metallicRoughness.png'
            },
            { x: 0, y: 0, z: 0 },
            1
        );
        // โหลดชื่อ
        loadOBJwithMaps(
            'https://chotika47.github.io/ComGraph_Final/name.obj',
            { },
            { x: 0, y: 0, z: 0 },
            1
        );
        // โหลดกรอบรูป
        loadOBJwithMaps(
            'https://chotika47.github.io/ComGraph_Final/profileImg.obj',
            { baseColor:'https://chotika47.github.io/ComGraph_Final/รูปชุดนิสิต.jpg'},
            { x: 0, y: 0, z: 0 },
            1
        );
        
        // โหลดกรอบรูปlogo
        loadOBJwithMaps(
            'https://chotika47.github.io/ComGraph_Final/logo_frame.obj',
            {},
            { x: 0, y: 0, z: 0 },
            1
        );
        // โหลดรูปlogo
        loadOBJwithMaps(
            'https://chotika47.github.io/ComGraph_Final/thLogoImg.obj',
            { baseColor:'https://chotika47.github.io/ComGraph_Final/KU_Symbol_Thai.jpg'},
            { x: 0, y: 0, z: 0 },
            1
        );
        
        // --- โหลดไฟล์ .glb ---
        /**/
        const loader = new THREE.GLTFLoader();
        loader.load(
            'https://chotika47.github.io/ComGraph_Final/awning.glb',  
            (gltf) => {
                const model = gltf.scene;
                scene.add(model);
            }
        );
        loader.load(
            'https://chotika47.github.io/ComGraph_Final/blank_fl.glb',  
            (gltf) => {
                const model = gltf.scene;
                scene.add(model);
            }
        );
        loader.load(
            'https://chotika47.github.io/ComGraph_Final/woodFloor.glb',  
            (gltf) => {
                const model = gltf.scene;
                scene.add(model);
            }
        );
            


        // ✅ render loop
        function animate(t) {
            //mesh.position.z = 5;
            // mesh.position.z = Math.sin(t*0.001)*1.5;
            renderer.render(scene, camera);
            requestAnimationFrame(animate);
        }
        animate(0);

        window.addEventListener('keydown', (event) => {

        });

    </script>
</body>

</html>
